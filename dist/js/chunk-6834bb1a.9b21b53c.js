(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6834bb1a"],{"0ba4":function(t,e,a){t.exports=a.p+"img/img_weapon.76447149.png"},"1c59":function(t,e,a){"use strict";var n=a("6d61"),s=a("6566");n("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),s)},"2b18":function(t,e,a){t.exports=a.p+"img/img_hand.cd9acc1c.png"},"317d":function(t,e,a){},"576b":function(t,e,a){},"5a88":function(t,e,a){t.exports=a.p+"img/img_body.b2c84633.png"},6062:function(t,e,a){a("1c59")},8336:function(t,e,a){t.exports=a.p+"img/img_head.c947a839.png"},"8a4a":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"blind-box-container"},[n("p-header"),n("div",{staticClass:"blind-box-content"},[n("div",{staticClass:"blind-box"},[t._m(0),n("div",{staticClass:"box-amount"},[n("div",{staticClass:"amount-minus amount-operator"},[n("div",{on:{click:function(e){return t.handleAmount("minus")}}})]),n("div",{staticClass:"amount-input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.amount,expression:"amount"}],attrs:{type:"text"},domProps:{value:t.amount},on:{input:[function(e){e.target.composing||(t.amount=e.target.value)},t.handleAmount]}})]),n("div",{staticClass:"amount-plus amount-operator"},[n("div",{on:{click:function(e){return t.handleAmount("plus")}}})])]),t._m(1),n("div",{staticClass:"box-btn"},[t._v(" COMING SOON! ")])])]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.state,expression:"state"}],staticClass:"open-modal"},[t.state?n("div",{staticClass:"open-mask",on:{click:t.hideModal}}):t._e(),n("div",{directives:[{name:"show",rawName:"v-show",value:1==t.state,expression:"state == 1"}],staticClass:"open-animation"},[n("video",{staticClass:"open-video",attrs:{id:"open-video",preload:"",src:a("9464")}})]),2==t.state?n("div",{staticClass:"open-result scroll-wrap"},[n("div",{staticClass:"close",on:{click:t.hideModal}}),n("div",{staticClass:"card-items scroll-wrap d-flex flex-wrap justify-center align-center"},t._l(t.units,(function(e,a){return n("div",{key:a,staticClass:"card-item",on:{click:t.rotateCard}},[n("div",{staticClass:"card-sides"},[n("div",{staticClass:"card-side card-front"}),n("div",{staticClass:"card-side card-back"},[n("p-card",{attrs:{item:e,type:"medium"}})],1)])])})),0)]):t._e()])],1)},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"box-img"},[n("img",{attrs:{src:a("a40d"),alt:""}})])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"box-price"},[n("div",{staticClass:"icon-busd"},[n("img",{attrs:{src:a("d909"),alt:""}})]),n("div",{staticClass:"price"},[t._v("29.9 BUSD")])])}],i=a("c7eb"),c=a("1da1"),o=a("5530"),r=(a("e9c4"),a("ac1f"),a("5319"),a("d3b7"),a("159b"),a("4e827"),a("d1ad")),l=a("d230"),u=a("2f62"),d=a("dc40");function h(t){return Object(d["a"])({url:"unit",method:"post",data:{hash:t}})}var m=a("89cb"),p=a("dd70"),f=a("ed08"),g=a("3ee0"),v=g.Shop,b=v.address,w=v.abi,A=g.Hpt,C=A.address,_=A.abi,y=g.Ice,T=y.address,x=y.abi,O={name:"BlindBox",components:{PHeader:r["a"],PCard:l["a"]},data:function(){return{video:null,shopCTR:null,myTokenCTR:null,loading:!1,state:0,amount:1,units:[],price:10,MTAllowance:0,retry:0,maxRetry:3,needApprove:!1,rules:null}},computed:Object(o["a"])({},Object(u["c"])(["web3","currentAccount","rootAccount","MT","GT"])),created:function(){var t=this;return Object(c["a"])(Object(i["a"])().mark((function e(){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.shopCTR=new t.web3.eth.Contract(w,b),t.myTokenCTR=new t.web3.eth.Contract(_,C),t.goldCTR=new t.web3.eth.Contract(x,T),!Object(f["d"])("UNIT_CODE_RULE")){e.next=7;break}t.rules=Object(f["d"])("UNIT_CODE_RULE"),e.next=11;break;case 7:return e.next=9,t.getRules();case 9:t.rules=e.sent,Object(f["g"])("UNIT_CODE_RULE",JSON.stringify(t.rules));case 11:case"end":return e.stop()}}),e)})))()},mounted:function(){this.init()},methods:Object(o["a"])(Object(o["a"])({},Object(u["b"])(["setGT","setMT"])),{},{init:function(){this.initChainBalance(),this.initChainAllowance()},initChainBalance:function(){this.getGTBalance(),this.getMTBalance()},initChainAllowance:function(){this.getMTAllowance()},handleAmount:function(t){var e=parseInt(this.amount)||0;this.amount="minus"==t?e-1<0?0:e-1:"plus"==t?e+1>50?50:e+1:e>50?50:e},buyBlindBox:function(){this.loading||(this.rootAccount.isLoggedIn?this.checkAllowance()?this.checkBalance()?this.amount<=0?this.$message.showMessage("请填写正确的购买数量"):this.buy(this.amount):this.$message.showMessage("余额不足，请充值"):this.approve():this.$EventBus.$emit("showConnect"))},approve:function(){var t=this;this.loading=!0;var e=this.convertToWei(p["a"]);this.myTokenCTR.methods.approve(b,e).send({from:this.currentAccount}).on("transactionHash",(function(t){console.log("approve","正在执行智能合约",t)})).then((function(){t.loading=!1,t.MTAllowance=e,t.checkAllowance(),t.$message.showMessage("授权成功"),console.log("approve","合约执行成功")})).catch((function(e){t.loading=!1,t.$message.showMessage("授权失败，请重试"),console.log("approve",e)}))},buy:function(t){var e=this;this.loading=!0,this.shopCTR.methods.buy(t).send({from:this.currentAccount}).on("transactionHash",(function(t){console.log("buy","正在执行智能合约",t)})).then((function(t){console.log("buy",t),e.mint(t.transactionHash)})).catch((function(t){e.loading=!1,e.$message.showMessage("购买失败，请重试"),console.log("buy",t)}))},mint:function(t){var e=this;h(t).then((function(t){e.loading=!1,e.state=1,e.units=t.units,console.log(t)})).catch((function(a){console.log("mint",a),e.retry>=e.maxRetry?(e.loading=!1,e.state=0,e.$message.showMessage("打开失败")):(e.mint(t),e.retry++)}))},rotateCard:function(t){t.currentTarget.classList.add("active")},getGTBalance:function(){var t=this;this.goldCTR.methods.balanceOf(this.currentAccount).call().then((function(e){console.log("[wallet] my GT: ",e),t.setGT(e)}))},getMTBalance:function(){var t=this;this.myTokenCTR.methods.balanceOf(this.currentAccount).call().then((function(e){console.log("[wallet] my MT: ",e),t.setMT(e)}))},getMTAllowance:function(){var t=this;this.myTokenCTR.methods.allowance(this.currentAccount,b).call().then((function(e){console.log("[wallet] my MT allowance: ",e),t.MTAllowance=e,t.checkAllowance()}))},checkBalance:function(){return!(this.amount*this.price>this.convertToEther(this.MT))},checkAllowance:function(){var t=this.convertToEther(this.MTAllowance),e=this.amount*this.price;return this.needApprove=t<=0||t<e,!this.needApprove},convertToWei:function(t){return this.web3.utils.toWei(t+"","ether")},convertToEther:function(t){return this.web3.utils.fromWei(t+"","ether").replace(/^(.*\..{4}).*$/,"$1")},getRules:function(){return new Promise((function(t){Object(m["b"])().then((function(e){var a={};e.rule.forEach((function(t){var e=t.part,n=t.attrs,s={},i=0;n.sort((function(t,e){return t.sort-e.sort})).forEach((function(t){t.start=i,t.end=i+t.bit_num,s[t.attr_key]=t,i=t.end})),a[e]=s})),t(a)}))}))},hideModal:function(){this.state=0}}),watch:{amount:function(){this.checkAllowance()},state:function(t){var e=this;if(1==t){var a=document.querySelector("#open-video");a.play(),a.addEventListener("ended",(function(){e.state=2}))}}}},k=O,R=(a("977a"),a("2877")),U=Object(R["a"])(k,n,s,!1,null,"5d87e316",null);e["default"]=U.exports},9464:function(t,e,a){t.exports=a.p+"media/open_box.b9831b1a.mp4"},"977a":function(t,e,a){"use strict";a("317d")},a40d:function(t,e,a){t.exports=a.p+"img/img_box.593daabd.png"},afed:function(t,e,a){"use strict";a("576b")},d230:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"part-item",class:"quality"+t.item.quality+" "+t.type},[n("div",{staticClass:"part-detail",class:t.selectedUnits&&t.selectedUnits[t.item.part]&&t.selectedUnits[t.item.part].atomic==t.item.atomic?"active":""},[n("div",{staticClass:"part-profession"},[n("img",{attrs:{src:t.partImgs["profession"+t.item.profession],alt:""}})]),n("div",{staticClass:"part-pos"},[n("img",{attrs:{src:t.partImgs["part"+t.item.part],alt:""}})]),n("div",{staticClass:"part-img d-flex flex-column align-center justify-center"},[1==t.item.part?n("img",{attrs:{src:a("8336"),alt:""}}):t._e(),2==t.item.part?n("img",{attrs:{src:a("5a88"),alt:""}}):t._e(),3==t.item.part?n("img",{attrs:{src:a("2b18"),alt:""}}):t._e(),4==t.item.part?n("img",{attrs:{src:a("ea65"),alt:""}}):t._e(),5==t.item.part?n("img",{attrs:{src:a("0ba4"),alt:""}}):t._e()]),n("div",{staticClass:"part-attrs d-flex flex-column justify-center align-center",class:"quality"+t.item.quality},[t._l(t.attrs,(function(e,a){return[t.item[e]?n("div",{key:a,staticClass:"part-attr d-flex"},[n("img",{staticClass:"attr-icon",attrs:{src:t.partImgs[e],alt:""}}),n("div",{staticClass:"attr-name"},[t._v(t._s(t.attrMap[e]))]),n("div",{staticClass:"attr-value"},[t._v(t._s(t.item[e]))])]):t._e()]}))],2)])])},s=[],i=a("2909"),c=a("c7eb"),o=a("1da1"),r=(a("e9c4"),a("d3b7"),a("159b"),a("4e827"),a("b64b"),a("6062"),a("3ca3"),a("ddb0"),a("ac1f"),a("5319"),a("89cb")),l=a("ed08"),u={name:"PCard",props:{item:{type:Object,default:null},selectedUnits:{type:Object,default:null},type:{type:String,default:"small"}},data:function(){return{partImgs:{},rules:null,attrs:[],attrMap:{blood:"生命力",attack_value:"攻击力",dodge:"闪避",hit:"命中",physical_defends:"装甲防御",magic_defends:"能量防御",reduce_harm_percent:"反伤(%)",reverse_harm_percent:"减伤(%)",attack_speed:"攻击速度",suck_blood:"吸血",critical_hit_rate:"暴击率(%)",critical_hit_effect:"暴击效果"}}},created:function(){var t=this;return Object(o["a"])(Object(c["a"])().mark((function e(){return Object(c["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.loadImgs(),!Object(l["d"])("UNIT_CODE_RULE")){e.next=5;break}t.rules=Object(l["d"])("UNIT_CODE_RULE"),e.next=9;break;case 5:return e.next=7,t.getRules();case 7:t.rules=e.sent,Object(l["g"])("UNIT_CODE_RULE",JSON.stringify(t.rules));case 9:t.attrs=t.getAttrs();case 10:case"end":return e.stop()}}),e)})))()},methods:{getRules:function(){return new Promise((function(t){Object(r["b"])().then((function(e){var a={};e.rule.forEach((function(t){var e=t.part,n=t.attrs,s={},i=0;n.sort((function(t,e){return t.sort-e.sort})).forEach((function(t){t.start=i,t.end=i+t.bit_num,s[t.attr_key]=t,i=t.end})),a[e]=s})),t(a)}))}))},getAttrs:function(){var t=[];for(var e in this.rules)t.push.apply(t,Object(i["a"])(Object.keys(this.rules[e])));return Object(i["a"])(new Set(t))},loadImgs:function(){var t=this,e=a("c84d");e.keys().forEach((function(e){a("b4c4")("./part"+e.replace(".","")).then((function(a){var n=/\.\/(.+)\.png/,s=n.exec(e)[1];t.$set(t.partImgs,s,a.default)}))}))}}},d=u,h=(a("afed"),a("2877")),m=Object(h["a"])(d,n,s,!1,null,"7b61c524",null);e["a"]=m.exports},d909:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUBAMAAADuRQ3yAAAAHlBMVEUAAAD7twD/wgD/zAD8uAD8uAD/vwD8twD7uAD8twCQgxxOAAAACXRSTlMA0hUKW78UTNBowwOoAAABNklEQVRIx9XWMU7EMBRFUQSjLMBdumQHNPS01FR0swaopqNgAyNB4d2CUL5vhD+6aWY081o/HcXfseSb82UuW5u343HaitYKK2itsIbCKgprKKyisIbCKrqwe0UjX/eKRp4vAH3djO6YraFPtWxFOTJHK6yhsIrCGgqrKKyhsIZG3rvq4S8aeeyqu3/Qz67JqqCwig6sJ+jdfr39KKToQ1nPNBop+nKcQKOSo7UW0Ojk6OrI5radHP1JAV3Ytxxt7Ly6zSn6ywYabI4GG2iwPQo78p/k6MJ21QSlygekaKSwLUMnhuVoYx0N1tHGOhqso411tLGGkkFRoig5FXowlMyOMltFYR2FVRTWUVhFYR2FVRRWUdgPRYmh5LrQYRTUHqX+1FUW1FlQZUGdBVUW1FlQZUFPnm9IBcM1D5fcZQAAAABJRU5ErkJggg=="},ea65:function(t,e,a){t.exports=a.p+"img/img_leg.7613f29b.png"}}]);